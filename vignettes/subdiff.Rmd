---
title: "subdiff: Analysis of Passive Particle-Tracking Data"
author: "Martin Lysy, Yun Ling"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Introduction to subdiff}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
source("format.R") # R formatting
```

<!-- markdown setup -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<!-- html-only macros -->
\newcommand{\bm}[1]{\boldsymbol{#1}}
\newcommand{\tx}[1]{\textrm{#1}}

<!-- regular latex macros -->

## `r section("Overview")`

The **subdiff** toolchain consists of several R packages providing various components for analyzing particle tracking data.

- `r pkg_link("subdiff")`: The main interface to the toolchain.
- `r pkg_link("LMN")`: Dimension reduction for parametric subdiffusion models.  In particular, these methods allow us to estimate linear or quadratic drift for 1-3 dimensional trajectories with zero computational overhead.
- `r pkg_link("mniw")`: Bayesian inference for parametric subdiffusion models.  In particular, these methods can be used to estimate heterogenity of the fluid medium from multiple trajectories.
- `r pkg_link("SuperGauss")`: Efficient computations for parametric models, i.e., scaling almost linearly in the number of timepoints.

### `r subsection("Installation")`

#### Windows/OSX

**SuperGauss** binaries are available on CRAN, so it can be installed from within an R session via e.g.,
```{r, eval = FALSE}
install.packages("SuperGauss")
```
The remaining packages are only on GitHub and contain C++ code which needs to be compiled from source.  The first step is to make sure your R environment is properly configured to compile C++ source code.  Please see the [Appendix](#appendix) for instructions on how to do this.  Next, install the `r pkg_link("devtools", "cran")` package (e.g., as above), then in the following order:
```{r, eval = FALSE}
devtools::install_github("mlysy/mniw")
devtools::install_github("mlysy/LMN")
devtools::install_github("mlysy/subdiff")
```

#### Linux/Installing from Source

On linux everything needs to be built from source, including **SuperGauss** which requires the `r pkg_link("FFTW", "http://www.fftw.org/")` C library to be installed.  Please see the [Appendix](#appendix) for how to do this.  There are also 

## `r section("Semi-Parametric MSD Estimation")`

## Appendix

### Configuring R to Compile C++ Source Code

- For Windows: Install `r pkg_link("Rtools", "https://cran.r-project.org/bin/windows/Rtools/")`.  Let the installer modify your system variable `PATH`.  

- For OSX: Install `r pkg_link("Clang 6.0.0", "https://cran.r-project.org/bin/macosx/tools/")` from the `.pkg` file on the CRAN website.

- To make sure the C++ compiler is correctly set up, install the `r pkg_link("Rcpp", "cran")` package and run the following:
```{r, eval = FALSE}
Rcpp::cppFunction(
  "double AddTest(double x, double y) {
     return x + y;
   }")
AddTest(5.2, 3.4)
```
If the code compiles and outputs `r 5.2+3.4` then the C++ compiler is interfaced with R correctly.

### Installing the **FFTW** Library

It can be downloaded from [here](http://www.fftw.org/download.html).  For Linux, install like anything else.  For Mac, I imagine that you can do the same.  For Windows, you **must** unzip the DLLs to a folder called ``C:/fftw``.  If for some reason you need administrator privileges for this, then in **`r paste0("SuperGauss_", "1.0", ".tar.gz")`** you must modify the file `src/Makevars.win` accordingly.  I apologize for this awkward step.  Future versions of the packages will simplify the installation process.

**Note**: A couple of Windows tests seems to indicate that we do not need to add `C:/fftw` to the system `PATH`, but if the installation doesn't work then perhaps this step is necessary after all...
